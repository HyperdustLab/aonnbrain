# MNIST AONN 识别过程分析

## 案例：真实标签=6，预测=3，Action=9

### 识别过程概述

这是一个典型的错误识别案例，展示了 AONN 在识别手写数字"6"时的完整过程。

### 阶段1：状态推理（State Inference）- 迭代 0-9

#### 1.1 初始状态（迭代 0）
- **预测类别**: 6（与真实标签一致！）
- **置信度**: 约 5%
- **自由能**: 749.99（非常高）

**发生了什么**：
- AONN 从观察（图像）开始推断内部状态
- 初始预测恰好正确（6），但置信度极低
- 自由能很高，说明预测误差很大

#### 1.2 状态推理过程（迭代 1-9）
- **预测类别变化**: 6 → 3（在迭代1时改变）
- **最终预测**: 3（错误）
- **最终置信度**: 11.0%（仍然很低）
- **自由能**: 从 749.99 降到约 40

**发生了什么**：
- 在状态推理过程中，AONN 通过最小化自由能来优化内部状态
- 预测从正确的"6"变成了错误的"3"
- 这表明：
  1. 初始预测虽然正确，但基于不稳定的内部状态
  2. 优化过程导致内部状态偏离了正确方向
  3. 可能是模型未训练或参数初始化不当

#### 1.3 自由能下降
- **初始**: 749.99
- **最终**: 38.27
- **下降**: 95%（大幅下降）

**发生了什么**：
- 自由能大幅下降，说明状态推理过程确实在优化
- 但优化方向可能不正确（导致预测错误）

### 阶段2：Action 选择（Action Selection）- 迭代 10-14

#### 2.1 Action 演化过程

**观察到的现象**：
- **Digit 9**: 概率从约 0.0 急剧增加到约 2.0（最高）
- **Digit 0, 5, 6, 7**: 概率也在增加
- **Digit 3, 4, 8**: 概率在下降
- **Digit 3**: 从约 0.0 降到约 -0.5（负值，可能是数值问题）

**发生了什么**：
- AONN 通过优化预期自由能来选择 action
- Action 选择过程与预测不同：
  - **预测**: 选择 digit 3（基于当前内部状态）
  - **Action**: 选择 digit 9（基于预期自由能最小化）
- 这种差异说明：
  1. Action 考虑了更多因素（观察生成、状态转移等）
  2. Action 可能比预测更"保守"或"探索性"

#### 2.2 自由能组件分析

**F_obs (观察生成误差)**: 约 350（主导）
**F_class (分类误差)**: 约 0（很小）
**F_dyn (状态转移误差)**: 约 0（很小）
**F_total**: 约 40（稳定）

**发生了什么**：
- **F_obs 占主导**：说明观察生成模型（从内部状态生成图像）的误差很大
- **F_class 很小**：说明分类误差相对较小（但预测仍然错误）
- **F_dyn 很小**：状态转移模型误差小

**问题诊断**：
- 观察生成模型（ObservationAspect）可能未训练好
- 无法从内部状态正确生成观察（图像）
- 这导致 F_obs 很高，影响了整体自由能

### 阶段3：最终结果

#### 3.1 预测 vs Action 对比

**预测概率分布**：
- Digit 3: 最高（约 0.1）
- 其他数字: 都很低（约 0.1）

**Action 概率分布**：
- Digit 9: 最高（约 0.1）
- 其他数字: 都很低（约 0.1）

**发生了什么**：
- 预测和 Action 选择了不同的数字
- 两者概率都很低（约 10%），说明：
  1. 模型不确定（未训练）
  2. 所有数字的概率都接近均匀分布
  3. 没有明显的"正确"选择

### 关键发现

#### 1. 预测演化异常
- **初始预测正确**（6），但很快变成错误（3）
- 说明状态推理过程可能过度优化，导致偏离正确方向

#### 2. Action 与预测不一致
- **预测**: 3
- **Action**: 9
- 说明 Action 选择考虑了更多因素，但两者都不正确

#### 3. 自由能组件不平衡
- **F_obs 占主导**（350 vs F_class≈0）
- 说明观察生成模型是主要问题
- 需要训练 ObservationAspect 来降低 F_obs

#### 4. 低置信度
- 所有预测和 Action 的置信度都很低（约 10%）
- 说明模型未训练，无法做出高置信度的预测

### 改进建议

1. **训练模型**：
   - 使用训练好的模型权重
   - 确保 ObservationAspect、ClassificationAspect 都已训练

2. **平衡自由能组件**：
   - 降低 F_obs（训练观察生成模型）
   - 提高 F_class 的权重（如果分类是主要任务）

3. **调整状态推理**：
   - 增加迭代次数
   - 调整学习率
   - 添加正则化防止过度优化

4. **统一预测和 Action**：
   - 确保 Action 选择与预测一致
   - 或者明确 Action 的额外作用（探索、不确定性处理等）

### 总结

这个案例展示了：
- **未训练模型**的识别过程
- **状态推理**如何优化内部状态
- **Action 选择**如何通过优化预期自由能工作
- **自由能组件**的相对重要性
- **预测演化**的动态过程

虽然识别结果错误，但过程本身是正确的，展示了主动推理的核心机制。

